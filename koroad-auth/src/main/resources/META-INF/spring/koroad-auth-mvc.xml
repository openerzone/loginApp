<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:p="http://www.springframework.org/schema/p"
       xmlns:mvc="http://www.springframework.org/schema/mvc"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                           http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/context
                           http://www.springframework.org/schema/context/spring-context.xsd
                           http://www.springframework.org/schema/mvc
                           http://www.springframework.org/schema/mvc/spring-mvc.xsd">
                           
    <!-- MVC Context: Controller만 스캔 -->
	<context:component-scan base-package="kr.or.koroad.auth">
		<context:include-filter type="annotation" expression="org.springframework.stereotype.Controller"/>
	</context:component-scan>

    <!-- MVC Configuration -->
    <mvc:annotation-driven />

	<!-- Property Placeholder 설정 -->
	<!-- 여러 properties 파일을 순서대로 로드하며, 나중에 로드된 파일이 이전 값을 오버라이드 -->
	<bean id="authMvcPropertyConfigurer"
        class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
        <property name="locations">
            <list>
                <!-- 1. 기본 설정 (koroad-auth 모듈) -->
                <value>classpath:/META-INF/auth/koroad-auth-mvc.properties</value>
                <!-- 2. 오버라이드 설정 (koroad-web 모듈) - 나중에 로드되어 우선순위가 높음 -->
                <value>classpath:/auth/koroad-auth-mvc.properties</value>
            </list>
        </property>
        <!-- 파일이 없어도 에러 발생하지 않도록 설정 -->
        <property name="ignoreResourceNotFound" value="true"/>
        <!-- 해결되지 않은 placeholder가 있어도 무시 -->
        <property name="ignoreUnresolvablePlaceholders" value="true"/>
    </bean>

	<!-- Thymeleaf View Resolver -->
    <bean id="templateResolver" class="org.thymeleaf.spring5.templateresolver.SpringResourceTemplateResolver">
        <property name="prefix" value="classpath:/META-INF/templates/auth" />
        <property name="suffix" value=".html" />
        <property name="templateMode" value="HTML" />
        <property name="characterEncoding" value="UTF-8" />
        <property name="cacheable" value="false" />
    </bean>

    <bean id="templateEngine" class="org.thymeleaf.spring5.SpringTemplateEngine">
        <property name="templateResolver" ref="templateResolver" />
        <property name="enableSpringELCompiler" value="true" />
    </bean> 
    
    <bean class="org.thymeleaf.spring5.view.ThymeleafViewResolver" p:order="0">
        <property name="templateEngine" ref="templateEngine" />
        <property name="characterEncoding" value="UTF-8" />
        <property name="viewNames" value="*" />
    </bean>    
</beans>
